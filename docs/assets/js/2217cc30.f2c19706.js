(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{77:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return p})),t.d(n,"default",(function(){return u}));var o=t(3),r=t(7),a=(t(0),t(93)),i=["components"],s={id:"debugging",title:"Debugging"},c={unversionedId:"getting-started/debugging",id:"getting-started/debugging",isDocsHomePage:!1,title:"Debugging",description:"The Problem",source:"@site/docs/getting-started/debugging.md",sourceDirName:"getting-started",slug:"/getting-started/debugging",permalink:"/fynpo/docs/getting-started/debugging",editUrl:"https://github.com/jchip/fynpo/tree/main/docusaurus/docs/docs/getting-started/debugging.md",version:"current",frontMatter:{id:"debugging",title:"Debugging"},sidebar:"someSidebar",previous:{title:"Publish Flow",permalink:"/fynpo/docs/getting-started/publish"},next:{title:"fynpo bootstrap",permalink:"/fynpo/docs/commands/bootstrap"}},p=[{value:"The Problem",id:"the-problem",children:[]},{value:"<code>fyn</code>&#39;s Solution",id:"fyns-solution",children:[]},{value:"<code>fynSourceMap</code>",id:"fynsourcemap",children:[]},{value:"Summary",id:"summary",children:[]}],l={toc:p};function u(e){var n=e.components,t=Object(r.a)(e,i);return Object(a.b)("wrapper",Object(o.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"the-problem"},"The Problem"),Object(a.b)("p",null,"When you install a local package ",Object(a.b)("strong",{parentName:"p"},"Pkg_A")," in another local package ",Object(a.b)("strong",{parentName:"p"},"Pkg_B"),", ",Object(a.b)("inlineCode",{parentName:"p"},"fyn")," creates hard linked copies of ",Object(a.b)("strong",{parentName:"p"},"Pkg_A"),"'s files in ",Object(a.b)("strong",{parentName:"p"},"Pkg_B"),"'s ",Object(a.b)("inlineCode",{parentName:"p"},"node_modules"),"."),Object(a.b)("p",null,"Like this:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"\u251c\u2500\u2500 fynpo.config.js\n\u2514\u2500\u2500 packages\n    \u251c\u2500\u2500 Pkg_A\n    \u2502   \u251c\u2500\u2500 index.js          <\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502   \u2514\u2500\u2500 package.json               |\n    \u2514\u2500\u2500 Pkg_B                          |\n        \u251c\u2500\u2500 index.js                   | hard link\n        \u251c\u2500\u2500 node_modules               |\n        \u2502   \u2514\u2500\u2500 Pkg_A                  |\n        \u2502       \u2514\u2500\u2500 index.js   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2514\u2500\u2500 package.json\n")),Object(a.b)("p",null,"The file ",Object(a.b)("inlineCode",{parentName:"p"},"Pkg_A/index.js")," shows up in two locations but they are the same file because they are linked. Modifying one will change the other."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"There is still a problem with this"),": when you are debugging ",Object(a.b)("strong",{parentName:"p"},"Pkg_B"),", if you need to trace through code in ",Object(a.b)("inlineCode",{parentName:"p"},"Pkg_A/index.js"),", your debugger will only see ",Object(a.b)("inlineCode",{parentName:"p"},"Pkg_B/node_modules/Pkg_A/index.js"),", not the one under ",Object(a.b)("inlineCode",{parentName:"p"},"packages/Pkg_A/index.js"),"."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"A rather inconvenient situation.")),Object(a.b)("p",null,"Other monorepo workspace solutions may not have this problem because they use symbolic links to link local packages, but that causes other problems like the ones listed in ",Object(a.b)("a",{parentName:"p",href:"https://classic.yarnpkg.com/en/docs/workspaces/#toc-limitations-caveats"},"yarn"),"."),Object(a.b)("h2",{id:"fyns-solution"},Object(a.b)("inlineCode",{parentName:"h2"},"fyn"),"'s Solution"),Object(a.b)("p",null,"If your debugger supports source maps, like the one in ",Object(a.b)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code"),", then ",Object(a.b)("inlineCode",{parentName:"p"},"fyn")," offers a way to solve this."),Object(a.b)("p",null,"There are two ways that we can get source maps:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"If your source code is in another dialect like TypeScript, then your packages are installed with the transpiled code. And you must enable source maps when you transpile your code."),Object(a.b)("li",{parentName:"ol"},"If you write your source code in idiomatic JavaScript, then ",Object(a.b)("inlineCode",{parentName:"li"},"fyn")," needs to generate pseudo source maps for them.")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"With (1), you don't need to do anything, ",Object(a.b)("inlineCode",{parentName:"li"},"fyn")," will take care of everything for you."),Object(a.b)("li",{parentName:"ul"},"With (2), ",Object(a.b)("inlineCode",{parentName:"li"},"fyn")," will also automatically take care of everything for you, but there is something it leaves in your code that you need to be aware of. See ",Object(a.b)("a",{parentName:"li",href:"#fynsourcemap"},"fynSourceMap")," below.")),Object(a.b)("p",null,"To make use of the source maps ",Object(a.b)("inlineCode",{parentName:"p"},"fyn")," setup for you, you need to setup your debugger to tell it to load source maps for code in ",Object(a.b)("inlineCode",{parentName:"p"},"node_modules"),", because most debuggers by default ignore files under ",Object(a.b)("inlineCode",{parentName:"p"},"node_modules")," for source maps."),Object(a.b)("p",null,"For ",Object(a.b)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code"),", this is a sample of what you need to setup in ",Object(a.b)("inlineCode",{parentName:"p"},".vscode/launch.json"),":"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-json"},'{\n  "version": "0.2.0",\n  "configurations": [\n    {\n      "name": "Attach app demo",\n      "port": 9229,\n      "request": "attach",\n      "skipFiles": ["<node_internals>/**"],\n      "type": "pwa-node",\n      "cwd": "${workspaceFolder}/apps/app-demo",\n      // outFiles tells vscode debugger the files it should look for source map info\n      "outFiles": [\n        // using ${cwd} here doesn\'t seem to work\n        // first exclude everything under node_modules\n        "!${workspaceFolder}/apps/app-demo/node_modules/**",\n        // when running app from transpiled code\n        "${workspaceFolder}/apps/app-demo/lib/**/*.js",\n        // when running app from source transpile on-the-fly with @babel/register\n        "${workspaceFolder}/apps/app-demo/src/**/*.(ts|tsx|js|jsx)",\n        // process any @myscope packages under node_modules for source mapping\n        // .f/_ is where fyn put the real copies of packages\n        "${workspaceFolder}/apps/app-demo/node_modules/.f/_/@myscope/**/*.js"\n      ]\n    }\n  ]\n}\n')),Object(a.b)("p",null,"This example assumes you put your local packages under the npm scope ",Object(a.b)("inlineCode",{parentName:"p"},"@myscope")," and the ",Object(a.b)("inlineCode",{parentName:"p"},"outFiles")," entry ",Object(a.b)("inlineCode",{parentName:"p"},'"${workspaceFolder}/apps/app-demo/node_modules/.f/_/@myscope/**/*.js"')," tells ",Object(a.b)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code")," debugger to process source maps under that directory and open the one in your original ",Object(a.b)("inlineCode",{parentName:"p"},"packages")," directory under your monorepo."),Object(a.b)("h2",{id:"fynsourcemap"},Object(a.b)("inlineCode",{parentName:"h2"},"fynSourceMap")),Object(a.b)("p",null,"If your code is idiomatic JavaScript without a transpile step, then ",Object(a.b)("inlineCode",{parentName:"p"},"fyn")," needs to generate pseudo source maps for your code."),Object(a.b)("p",null,"It needs to add to your code the reference to the source maps so ",Object(a.b)("a",{parentName:"p",href:"https://code.visualstudio.com/"},"Visual Studio Code")," will load them."),Object(a.b)("p",null,"It looks like this in a file named ",Object(a.b)("inlineCode",{parentName:"p"},"index.js"),":"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre"},"//# fynSourceMap=true\n//# sourceMappingURL=index.js.fyn.map\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"It's recommended that you commit your code with these for convenience."),Object(a.b)("li",{parentName:"ul"},"You can tell ",Object(a.b)("inlineCode",{parentName:"li"},"fyn")," to skip generating pseudo source maps by setting ",Object(a.b)("inlineCode",{parentName:"li"},"fynSourceMap")," to ",Object(a.b)("inlineCode",{parentName:"li"},"false"),"."),Object(a.b)("li",{parentName:"ul"},"If you use ",Object(a.b)("inlineCode",{parentName:"li"},"nyc")," for unit test coverage, then it will fail trying to load the source maps. To get around that, set ",Object(a.b)("inlineCode",{parentName:"li"},"nyc"),"'s option ",Object(a.b)("inlineCode",{parentName:"li"},"sourceMap")," to ",Object(a.b)("inlineCode",{parentName:"li"},"false"),".")),Object(a.b)("h2",{id:"summary"},"Summary"),Object(a.b)("p",null,"With a debugger that supports source maps, you can debug and trace through your code in your ",Object(a.b)("inlineCode",{parentName:"p"},"fynpo")," using the original copy of your files instead of the one linked in ",Object(a.b)("inlineCode",{parentName:"p"},"node_modules"),"."))}u.isMDXComponent=!0},93:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=r.a.createContext({}),l=function(e){var n=r.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=l(e.components);return r.a.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=r.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(t),b=o,m=u["".concat(i,".").concat(b)]||u[b]||d[b]||a;return t?r.a.createElement(m,s(s({ref:n},p),{},{components:t})):r.a.createElement(m,s({ref:n},p))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=b;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=t[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);